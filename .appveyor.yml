version: 1.0.{build}

branches:
  only:
  - master

clone_folder: C:\projects\appleseed

image:
  - Visual Studio 2017
  - Visual Studio 2015

configuration: Debug

platform: x64

build_script:
  project: build\appleseed.sln
  parallel: true
  verbosity: normal

install:
  - cmd: >-
      appveyor DownloadFile https://github.com/appleseedhq/appleseed-deps/releases/download/v19/appleseed-deps-stage-win64-%VS%-v19.zip
      7z x appleseed-deps-stage-win64-%VS%-v19.zip -oappleseed-deps-stage-win64-%VS%-v19
      rm appleseed-deps-stage-win64-%VS%-v19.zip

      appveyor DownloadFile https://github.com/appleseedhq/appveyor-deps/releases/download/v2/boost_1_69_0_%VC%.zip
      7z x boost_1_69_0_%VC%.zip
      rm boost_1_69_0_%VC%.zip

before_build:
  - cmd: >-
      mkdir build
      cd build
      cmake -G %CMakeGenerator% -DWITH_DISNEY_MATERIAL=ON -DWITH_STUDIO=OFF -DUSE_SSE42=ON -DBOOST_ROOT=C:\projects\appleseed\boost_1_69_0_%VC% -DPYTHON_INCLUDE_DIR=C:\Python27-x64\include -DPYTHON_LIBRARY=C:\Python27-x64\libs\python27.lib -DAPPLESEED_DEPS_STAGE_DIR=C:\projects\appleseed\appleseed-deps-stage-win64-%VS%-v19\stage\%VC% ..

test_script:
  - cmd: >-
      cd C:\projects\appleseed\sandbox\bin\%VI%\Debug

      appleseed.cli --run-unit-tests --verbose-unit-tests

      set PYTHONPATH=C:\projects\appleseed\sandbox\lib\%VI%\Debug\python;%PYTHONPATH%
      set PATH=C:\projects\appleseed\sandbox\bin\%VI%\Debug;%PATH%
      cd C:\projects\appleseed\sandbox\lib\%VI%\Debug\python\appleseed
      py -2 runtests.py

for:
  -
    matrix:
      only:
        - image: Visual Studio 2017

    environment:
      CMakeGenerator: "Visual Studio 15 2017 Win64"
      VS: vs141
      VC: vc141
      VI: v141
      
  -
    matrix:
      only:
        - image: Visual Studio 2015

    environment:
      CMakeGenerator: "Visual Studio 14 2015 Win64"
      VS: vs140
      VC: vc140
      VI: v140
