<?xml version="1.0" encoding="UTF-8"?>
<!-- File generated by appleseed.dll version 2.1.0-beta (SSE SSE2 SSE3 SSSE3 SSE4.1 SSE4.2 F16C). -->
<project format_revision="34">
    <search_paths>
        <search_path>
            ../../../shaders/appleseed
        </search_path>
    </search_paths>
    <scene>
        <camera name="Camera" model="pinhole_camera">
            <parameter name="aspect_ratio" value="1.77778" />
            <parameter name="controller_target" value="0.024851 -0.0537348 0.0125937" />
            <parameter name="film_dimensions" value="0.036 0.02025" />
            <parameter name="focal_length" value="0.05" />
            <parameter name="near_z" value="-0.001" />
            <parameter name="shift_x" value="0" />
            <parameter name="shift_y" value="0" />
            <parameter name="shutter_close_begin_time" value="1" />
            <parameter name="shutter_close_end_time" value="1" />
            <parameter name="shutter_open_begin_time" value="0" />
            <parameter name="shutter_open_end_time" value="0" />
            <transform time="0">
                <matrix>
                    0.68592065572738647 -0.32401347160339355 0.65155822038650513 7.35889148712158203
                    0.00000000000000000 0.89539563655853271 0.44527140259742737 4.95830917358398438
                    -0.72767633199691772 -0.30542084574699402 0.61417037248611450 6.92579078674316406
                    0.00000000000000000 0.00000000000000000 0.00000000000000000 1.00000000000000000
                </matrix>
            </transform>
        </camera>
        <environment_edf name="sky_edf" model="hosek_environment_edf">
            <parameter name="ground_albedo" value="0.3" />
            <parameter name="horizon_shift" value="0" />
            <parameter name="luminance_gamma" value="1" />
            <parameter name="luminance_multiplier" value="1" />
            <parameter name="saturation_multiplier" value="1" />
            <parameter name="sun_phi" value="0" />
            <parameter name="sun_theta" value="10" />
            <parameter name="turbidity" value="4" />
            <parameter name="turbidity_multiplier" value="2" />
        </environment_edf>
        <environment_shader name="sky_shader" model="edf_environment_shader">
            <parameter name="alpha_value" value="1" />
            <parameter name="environment_edf" value="sky_edf" />
        </environment_shader>
        <environment name="sky" model="generic_environment">
            <parameter name="environment_edf" value="sky_edf" />
            <parameter name="environment_shader" value="sky_shader" />
        </environment>
        <assembly name="assembly">
            <color name="Light_radiance">
                <parameter name="color_space" value="linear_rgb" />
                <values>
                    0.800000012 0.800000012 0.800000012
                </values>
                <alpha>
                    1.000000000
                </alpha>
            </color>
            <shader_group name="Material.001_tree">
                <shader type="shader" name="AppleseedRivetsNode" layer="Rivets">
                    <parameter name="Scale" value="float 0.125" />
                    <osl_code>
// Steampunk Rivets and wobbly metal shader
// Rivets.osl, by Zap Andersson
// Modified: 2018-02-08
// Copyright 2018 Autodesk Inc, All rights reserved. This file is licensed under Apache 2.0 license
//    https://github.com/ADN-DevTech/3dsMax-OSL-Shaders/blob/master/LICENSE.txt

float edgeTweak(float gap, float width, float coord)
{
    return smoothstep(gap, gap+width, coord);
}

shader Rivets
[[ string help = &quot;Adds rivets along the edges of UV space 1x1 squares, as&lt;br/&gt;well as bending the squares for Steam-Punky un-evenness&quot; ]]
(
    // Parmeters and their DEFAULT values
    point UVW   = vector(u,v,0) 
        [[ string help=&quot;The position to shade. Default to the standard UV space.&quot; ]],
    float Scale = 0.5, 
  
    int   U_Rivets = 6,
    int   V_Rivets = 6,
    float RivetRadius = 0.3,
    float Dirt = 0.1,
  
    int   Seed = 0,
  
    color PlateColor = color(0.5,0.7,0.5),
    color RivetColor = color(0.7,0.3,0.1),
    color DirtColor  = color(0.1,0.1,0.1),  
    color SpaceColor = color(0.08,0.04,0.01),
    color HoleColor  = 0.02,
  
    vector RivetCenter = vector(0.5,0.5,0),
    vector RivetRandom = 0,
    float  RivetProbability = 1.0,
    float  HoleRadius  = 0.1,
    float  HoleEdge    = 0.02,
    
    float  BumpAmount = 2.0,
    float  BumpShape  = 0.25,
    
    float  PlateGap    = 0.01,
    float  PlateEdge   = 0.02,
    vector PlateWobble = 0.0,
    vector WobbleScale = 1.0,
    int    RivetWobble = 1
        [[ string widget = &quot;checkBox&quot;,
           string label  = &quot;Rivets follow plate wobble&quot;,
           string help   = &quot;If enabed, rivets will follow the warped space of the plates&quot; ]],  
    output color Col = 0,
    output float RivetFac  = 0,
    output float HoleFac   = 0,
    output float PlateFac  = 0,
    output float Dist      = 0,
    output float Bump      = 0,
    output int   TileIdx   = 0,
    output int   PlateIdx  = 0,
)
{
    // Main Shader code
    float RR = RivetRadius / 2.0;
    point p  = UVW / Scale;

    // And index number for each plate, so the wobble
    // randomness can be different for each plate
    int plateIdx = int(p[0]) * 13 + int(p[1]) * 32 + 115 * Seed;

    // Throw away the integer part, so we get 0 - 1.0 
    // as coordinates inside each &quot;plate&quot;
    point modP = fmod(p, point(1));

    // Tweak the point a little by the &quot;wobble&quot; 
    vector wob = noise(&quot;perlin&quot;, modP / WobbleScale, plateIdx);
    
    modP += (PlateWobble / 10.0) * wob;
    
    // Check if we are near the edge of the plate
    if (modP[0] &lt; PlateGap || 1.0 - modP[0] &lt; PlateGap ||
        modP[1] &lt; PlateGap || 1.0 - modP[1] &lt; PlateGap)
    {
        // If so, use the Space Color (for the gap)
        Col      = SpaceColor;
        PlateFac = 0.0;
        PlateIdx = 0;
    }
    else 
    {
        // We are on the plate
        Col      = PlateColor;
        PlateFac = 1.0 + PlateWobble[2] * wob[2] * 5.0;
        
        // If we are on the plate, but near the edge, tweak
        // the PlateFactor output (which we also use for bump)
        // to give a bump effect
        PlateFac *= edgeTweak(PlateGap, PlateEdge, modP[0]);
        PlateFac *= edgeTweak(PlateGap, PlateEdge, modP[1]);        
        PlateFac *= edgeTweak(PlateGap, PlateEdge, 1.0 - modP[0]);
        PlateFac *= edgeTweak(PlateGap, PlateEdge, 1.0 - modP[1]);
        
        PlateIdx = plateIdx;
    }
    
    // Should rivets follow plate wobble?
    if (RivetWobble)
        p += (PlateWobble / 10.0) * wob;
    
    // Compute rivet coordinates :)
    float rivetu = p[0] * U_Rivets;
    float rivetv = p[1] * V_Rivets;
    
    // Calculate rivet cell number in U and V
    int   rcU = int(rivetu);
    int   rcV = int(rivetv);

    // Compute an index for the tile, to seed other randomness with
    TileIdx = rcU + rcV * 100 + 50 * Seed;
    
    // Mod down to one plate
    rcU = rcU % U_Rivets;
    rcV = rcV % V_Rivets;

    // Only do rivets in the 1st row, 1st column, last row or last column
    if (rcU == 0 || rcV == 0 || 
        rcU == U_Rivets-1 || rcV == V_Rivets-1)
    {
        // In a rivet row
        vector rnd = (noise(&quot;cell&quot;, TileIdx) - vector(0.5,0.5,0));
        int    doit = rnd[2] &lt; RivetProbability;
        rnd[2] = 0;
        
        point rp = point(fmod(rivetu, 1.0), fmod(rivetv, 1.0), 0);
        point rc = RivetCenter + RivetRandom * rnd;
        
        float dist  = distance(rp, rc);
        Dist = dist / RR;       
        
    
        // Check if we are inside a rivet
        if (dist &lt; RR &amp;&amp; doit)
        {       
            Bump     = pow(sin((1.0 - Dist) * 1.5), BumpShape) * BumpAmount;            
            Col      = RivetColor;
            RivetFac = 1.0;
        }
        else if (dist &lt; RR + Dirt) // We are outside it, but in the dirt area
        {
            float da = smoothstep(0.0, 1.0, (dist - RR) / Dirt);            
            Col = mix(DirtColor * Col, Col, da);
            
            if (dist &lt; HoleRadius + HoleEdge)
            {
                PlateFac *= clamp((dist - HoleRadius) / HoleEdge, 0.0, 1.0);
                if (dist &lt; HoleRadius)
                {
                    Col = HoleColor;
                    RivetFac = 1.0;
                    HoleFac  = 1.0;
                }
            }
        }       
    }   
    
    // Add the platefactor to bump output
    Bump += PlateFac;
}
                    </osl_code>
                </shader>
                <shader type="shader" name="as_disney_material" layer="asDisneyMaterial">
                </shader>
                <shader type="surface" name="as_closure2surface" layer="asClosure2Surface">
                </shader>
                <connect_shaders src_layer="Rivets" src_param="Col" dst_layer="asDisneyMaterial" dst_param="in_color" />
                <connect_shaders src_layer="asDisneyMaterial" src_param="out_outColor" dst_layer="asClosure2Surface" dst_param="in_input" />
            </shader_group>
            <shader_group name="Material.002_tree">
                <shader type="shader" name="AppleseedCheckerNode" layer="Checker">
                    <parameter name="Scale" value="float 0.125" />
                    <osl_code>
shader Checker
[[ string help = &quot;A simple Checkboard OSL sample shader&quot; ]]
(
  point UVW   = vector(u,v,0) 
    [[ string help=&quot;The position to shade. Default to the standard UV space.&quot; ]],
  float Scale = 0.25, 
  color Color1 = color(1,1.0,0.2),   
  color Color2 = color(0.2,0.2,1.0),  

  output color Col = 0
)
{
    point p = UVW / Scale;
    int x = (int)mod(p[0],2.0);
    int y = (int)mod(p[1],2.0);
    int z = (int)mod(p[2],2.0);

    if( ((x%2) ^ (y%2)) == (z%2) ){
        Col = Color1;
    } else {
        Col = Color2;
    }
}
                    </osl_code>
                </shader>
                <shader type="shader" name="as_disney_material" layer="asDisneyMaterial">
                </shader>
                <shader type="surface" name="as_closure2surface" layer="asClosure2Surface">
                </shader>
                <connect_shaders src_layer="Checker" src_param="Col" dst_layer="asDisneyMaterial" dst_param="in_color" />
                <connect_shaders src_layer="asDisneyMaterial" src_param="out_outColor" dst_layer="asClosure2Surface" dst_param="in_input" />
            </shader_group>
            <surface_shader name="Material.001_surface" model="physical_surface_shader">
                <parameter name="lighting_samples" value="1" />
            </surface_shader>
            <surface_shader name="Material.002_surface" model="physical_surface_shader">
                <parameter name="lighting_samples" value="1" />
            </surface_shader>
            <surface_shader name="__default_surface_shader" model="diagnostic_surface_shader">
                <parameter name="mode" value="facing_ratio" />
            </surface_shader>
            <material name="Material.001" model="osl_material">
                <parameter name="osl_surface" value="Material.001_tree" />
                <parameter name="surface_shader" value="Material.001_surface" />
            </material>
            <material name="Material.002" model="osl_material">
                <parameter name="osl_surface" value="Material.002_tree" />
                <parameter name="surface_shader" value="Material.002_surface" />
            </material>
            <material name="__default_material" model="generic_material">
                <parameter name="surface_shader" value="__default_surface_shader" />
            </material>
            <material name="__null_material" model="generic_material" />
            <light name="Light" model="point_light">
                <parameter name="cast_indirect_light" value="true" />
                <parameter name="exposure" value="0" />
                <parameter name="importance_multiplier" value="1" />
                <parameter name="intensity" value="Light_radiance" />
                <parameter name="intensity_multiplier" value="25" />
                <transform>
                    <matrix>
                        -0.29086464643478394 -0.77110081911087036 0.56639319658279419 4.07624530792236328
                        -0.05518905818462372 0.60452473163604736 0.79467225074768066 5.90386199951171875
                        -0.95517116785049438 0.19988335669040680 -0.21839119493961334 -1.00545394420623779
                        0.00000000000000000 0.00000000000000000 0.00000000000000000 1.00000000000000000
                    </matrix>
                </transform>
            </light>
            <object name="Cube.001" model="mesh_object">
                <parameter name="filename" value="_geometry/350f3b39aa0343ef25c975a1a31f0c38.binarymesh" />
            </object>
            <object name="Cube" model="mesh_object">
                <parameter name="filename" value="_geometry/350f3b39aa0343ef25c975a1a31f0c38.binarymesh" />
            </object>
            <object_instance name="Cube.001_inst" object="Cube.001.mesh">
                <parameter name="medium_priority" value="0" />
                <parameter name="photon_target" value="false" />
                <parameter name="shadow_terminator_correction" value="0" />
                <parameters name="visibility">
                    <parameter name="camera" value="true" />
                    <parameter name="diffuse" value="true" />
                    <parameter name="glossy" value="true" />
                    <parameter name="light" value="true" />
                    <parameter name="shadow" value="true" />
                    <parameter name="specular" value="true" />
                    <parameter name="transparency" value="true" />
                </parameters>
                <transform>
                    <matrix>
                        1.00000000000000000 0.00000000000000000 0.00000000000000000 1.40492796897888184
                        0.00000000000000000 0.00000000000000000 1.00000000000000000 0.02195533365011215
                        -0.00000000000000000 -1.00000000000000000 -0.00000000000000000 -1.50637459754943848
                        0.00000000000000000 0.00000000000000000 0.00000000000000000 1.00000000000000000
                    </matrix>
                </transform>
                <assign_material slot="default" side="front" material="Material.002" />
                <assign_material slot="default" side="back" material="Material.002" />
            </object_instance>
            <object_instance name="Cube_inst" object="Cube.mesh">
                <parameter name="medium_priority" value="0" />
                <parameter name="photon_target" value="false" />
                <parameter name="shadow_terminator_correction" value="0" />
                <parameters name="visibility">
                    <parameter name="camera" value="true" />
                    <parameter name="diffuse" value="true" />
                    <parameter name="glossy" value="true" />
                    <parameter name="light" value="true" />
                    <parameter name="shadow" value="true" />
                    <parameter name="specular" value="true" />
                    <parameter name="transparency" value="true" />
                </parameters>
                <transform>
                    <matrix>
                        1.00000000000000000 0.00000000000000000 0.00000000000000000 -1.43856799602508545
                        0.00000000000000000 0.00000000000000000 1.00000000000000000 -0.02195527032017708
                        0.00000000000000000 -1.00000000000000000 0.00000000000000000 1.54206252098083496
                        0.00000000000000000 0.00000000000000000 0.00000000000000000 1.00000000000000000
                    </matrix>
                </transform>
                <assign_material slot="default" side="front" material="Material.001" />
                <assign_material slot="default" side="back" material="Material.001" />
            </object_instance>
        </assembly>
        <assembly_instance name="assembly_inst" assembly="assembly">
        </assembly_instance>
    </scene>
    <output>
        <frame name="beauty">
            <parameter name="camera" value="Camera" />
            <parameter name="denoise_scales" value="3" />
            <parameter name="denoiser" value="off" />
            <parameter name="filter" value="blackman-harris" />
            <parameter name="filter_size" value="1.5" />
            <parameter name="mark_invalid_pixels" value="false" />
            <parameter name="noise_seed" value="0" />
            <parameter name="patch_distance_threshold" value="1" />
            <parameter name="prefilter_spikes" value="true" />
            <parameter name="random_pixel_order" value="true" />
            <parameter name="resolution" value="960 540" />
            <parameter name="skip_denoised" value="true" />
            <parameter name="spike_threshold" value="2" />
            <parameter name="tile_size" value="64 64" />
        </frame>
    </output>
    <configurations>
        <configuration name="final" base="base_final">
            <parameter name="device" value="cpu" />
            <parameter name="lighting_engine" value="pt" />
            <parameter name="passes" value="1" />
            <parameter name="pixel_renderer" value="uniform" />
            <parameter name="shading_result_framebuffer" value="ephemeral" />
            <parameter name="spectrum_mode" value="rgb" />
            <parameter name="tile_renderer" value="generic" />
            <parameter name="use_embree" value="false" />
            <parameters name="adaptive_tile_renderer">
                <parameter name="batch_size" value="8" />
                <parameter name="max_samples" value="256" />
                <parameter name="min_samples" value="16" />
                <parameter name="noise_threshold" value="1" />
            </parameters>
            <parameters name="generic_frame_renderer">
            </parameters>
            <parameters name="light_sampler">
                <parameter name="algorithm" value="cdf" />
                <parameter name="enable_importance_sampling" value="false" />
                <parameter name="enable_light_importance_sampling" value="false" />
            </parameters>
            <parameters name="progressive_frame_renderer">
                <parameter name="max_average_spp" value="-1" />
                <parameter name="max_fps" value="10" />
                <parameter name="time_limit" value="60" />
            </parameters>
            <parameters name="pt">
                <parameter name="clamp_roughness" value="false" />
                <parameter name="dl_light_samples" value="1" />
                <parameter name="dl_low_light_threshold" value="0" />
                <parameter name="enable_caustics" value="false" />
                <parameter name="enable_dl" value="true" />
                <parameter name="enable_ibl" value="true" />
                <parameter name="ibl_env_samples" value="1" />
                <parameter name="max_bounces" value="8" />
                <parameter name="max_diffuse_bounces" value="8" />
                <parameter name="max_glossy_bounces" value="8" />
                <parameter name="max_specular_bounces" value="8" />
                <parameter name="max_volume_bounces" value="8" />
                <parameter name="next_event_estimation" value="true" />
                <parameter name="optimize_for_lights_outside_volumes" value="true" />
                <parameter name="record_light_paths" value="false" />
                <parameter name="rr_min_path_length" value="6" />
                <parameter name="volume_distance_samples" value="2" />
            </parameters>
            <parameters name="sppm">
                <parameter name="alpha" value="0.7" />
                <parameter name="dl_mode" value="rt" />
                <parameter name="enable_caustics" value="true" />
                <parameter name="enable_ibl" value="true" />
                <parameter name="enable_importons" value="true" />
                <parameter name="env_photons_per_pass" value="1000000" />
                <parameter name="importon_lookup_radius" value="5" />
                <parameter name="initial_photon_lookup_radius" value="0.1" />
                <parameter name="light_photons_per_pass" value="1000000" />
                <parameter name="max_photons_per_estimate" value="100" />
                <parameter name="path_tracing_max_bounces" value="-1" />
                <parameter name="path_tracing_rr_min_path_length" value="6" />
                <parameter name="photon_tracing_max_bounces" value="-1" />
                <parameter name="photon_tracing_rr_min_path_length" value="6" />
                <parameter name="photon_type" value="poly" />
            </parameters>
            <parameters name="texture_controlled_pixel_renderer">
                <parameter name="file_path" value="C:\Program Files\Blender Foundation\Blender 2.82" />
                <parameter name="force_antialiasing" value="true" />
                <parameter name="max_samples" value="256" />
                <parameter name="min_samples" value="16" />
            </parameters>
            <parameters name="uniform_pixel_renderer">
                <parameter name="force_antialiasing" value="true" />
                <parameter name="samples" value="32" />
            </parameters>
        </configuration>
        <configuration name="interactive" base="base_interactive">
            <parameter name="device" value="cpu" />
            <parameter name="lighting_engine" value="pt" />
            <parameter name="passes" value="1" />
            <parameter name="pixel_renderer" value="uniform" />
            <parameter name="shading_result_framebuffer" value="ephemeral" />
            <parameter name="spectrum_mode" value="rgb" />
            <parameter name="tile_renderer" value="generic" />
            <parameter name="use_embree" value="false" />
            <parameters name="adaptive_tile_renderer">
                <parameter name="batch_size" value="8" />
                <parameter name="max_samples" value="256" />
                <parameter name="min_samples" value="16" />
                <parameter name="noise_threshold" value="1" />
            </parameters>
            <parameters name="generic_frame_renderer">
            </parameters>
            <parameters name="light_sampler">
                <parameter name="algorithm" value="cdf" />
                <parameter name="enable_importance_sampling" value="false" />
                <parameter name="enable_light_importance_sampling" value="false" />
            </parameters>
            <parameters name="progressive_frame_renderer">
                <parameter name="max_fps" value="10" />
                <parameter name="time_limit" value="60" />
            </parameters>
            <parameters name="pt">
                <parameter name="clamp_roughness" value="false" />
                <parameter name="dl_light_samples" value="1" />
                <parameter name="dl_low_light_threshold" value="0" />
                <parameter name="enable_caustics" value="false" />
                <parameter name="enable_dl" value="true" />
                <parameter name="enable_ibl" value="true" />
                <parameter name="ibl_env_samples" value="1" />
                <parameter name="max_bounces" value="8" />
                <parameter name="max_diffuse_bounces" value="8" />
                <parameter name="max_glossy_bounces" value="8" />
                <parameter name="max_specular_bounces" value="8" />
                <parameter name="max_volume_bounces" value="8" />
                <parameter name="next_event_estimation" value="true" />
                <parameter name="optimize_for_lights_outside_volumes" value="true" />
                <parameter name="record_light_paths" value="false" />
                <parameter name="rr_min_path_length" value="6" />
                <parameter name="volume_distance_samples" value="2" />
            </parameters>
            <parameters name="texture_controlled_pixel_renderer">
                <parameter name="file_path" value="C:\Program Files\Blender Foundation\Blender 2.82" />
                <parameter name="max_samples" value="256" />
                <parameter name="min_samples" value="16" />
            </parameters>
            <parameters name="uniform_pixel_renderer">
                <parameter name="force_antialiasing" value="true" />
                <parameter name="samples" value="16" />
            </parameters>
        </configuration>
    </configurations>
</project>
